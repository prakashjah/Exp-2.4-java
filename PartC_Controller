package partc.controller;

import partc.dao.StudentDAO;
import partc.model.Student;
import partc.view.StudentView;

import java.sql.SQLException;
import java.util.List;
import java.util.Scanner;

public class StudentController {
    private StudentDAO dao = new StudentDAO();
    private StudentView view = new StudentView();

    public void listAll() {
        try {
            List<Student> list = dao.getAll();
            view.printAll(list);
        } catch (SQLException e) {
            e.printStackTrace();
        }
    }

    public void add(Scanner sc) {
        try {
            System.out.print("Name: "); String name = sc.nextLine();
            System.out.print("Email: "); String email = sc.nextLine();
            System.out.print("Course: "); String course = sc.nextLine();
            Student s = new Student(name, email, course);
            dao.addStudent(s);
            view.printStudent(s);
        } catch (SQLException e) { e.printStackTrace(); }
    }

    public void update(Scanner sc) {
        try {
            System.out.print("ID to update: "); int id = Integer.parseInt(sc.nextLine());
            Student s = dao.getById(id);
            if (s == null) { System.out.println("Not found"); return; }
            System.out.print("New name (enter for skip): "); String name = sc.nextLine();
            if (!name.isBlank()) s.setName(name);
            System.out.print("New email (enter for skip): "); String email = sc.nextLine();
            if (!email.isBlank()) s.setEmail(email);
            System.out.print("New course (enter for skip): "); String course = sc.nextLine();
            if (!course.isBlank()) s.setCourse(course);
            boolean ok = dao.update(s);
            System.out.println(ok ? "Updated" : "Update failed");
        } catch (SQLException e) { e.printStackTrace(); }
    }

    public void delete(Scanner sc) {
        try {
            System.out.print("ID to delete: "); int id = Integer.parseInt(sc.nextLine());
            boolean ok = dao.delete(id);
            System.out.println(ok ? "Deleted" : "Delete failed");
        } catch (SQLException e) { e.printStackTrace(); }
    }

    public static void main(String[] args) {
        StudentController ctrl = new StudentController();
        Scanner sc = new Scanner(System.in);
        while (true) {
            System.out.println("""\
1. List all
2. Add
3. Update
4. Delete
5. Exit
""");
            System.out.print("Choose: ");
            String c = sc.nextLine();
            switch (c) {
                case "1": ctrl.listAll(); break;
                case "2": ctrl.add(sc); break;
                case "3": ctrl.update(sc); break;
                case "4": ctrl.delete(sc); break;
                case "5": System.out.println("Bye"); sc.close(); return;
                default: System.out.println("Invalid");
            }
        }
    }
}
